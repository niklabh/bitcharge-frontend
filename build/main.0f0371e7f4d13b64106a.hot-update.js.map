{"version":3,"file":"main.0f0371e7f4d13b64106a.hot-update.js","sources":["webpack:///src/server.js"],"sourcesContent":["import App from './App'\nimport React from 'react'\nimport { StaticRouter, matchPath } from 'react-router-dom'\nimport express from 'express'\nimport { renderToString } from 'react-dom/server'\n\nimport routes from './routes'\n\nconst assets = require(process.env.RAZZLE_ASSETS_MANIFEST)\n\nconst server = express()\nserver\n  .disable('x-powered-by')\n  .use(express.static(process.env.RAZZLE_PUBLIC_DIR))\n  .get('/*', (req, res) => {\n    const context = {}\n\n    const matches = routes.map((route, index) => {\n      const match = matchPath(req.url, route.path, route)\n      if (match) {\n        const obj = {\n          route,\n          match,\n          promise: route.component.getInitialData ? route.component.getInitialData({ match, req, res }) : Promise.resolve(null)\n        }\n        return obj\n      }\n\n      return null\n    })\n    console.log(matches)\n    if (matches.length === 0) {\n      res.status(404).send('Not found')\n    }\n\n    const promises = matches.map(match => (match ? match.promise : null))\n\n    console.log('promises', promises)\n\n    Promise.all(promises)\n      .then(data => {\n        const markup = renderToString(\n          <StaticRouter context={context} location={req.url}>\n            <App routes={routes} initialData={data} />\n          </StaticRouter>\n        )\n        console.log(markup)\n        if (context.url) {\n          res.redirect(context.url)\n        } else {\n          res.status(200).send(\n            `<!doctype html>\n        <html lang=\"\">\n        <head>\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n            <meta charset=\"utf-8\" />\n            <link rel=\"manifest\" href=\"/manifest.json\">\n            <link rel=\"shortcut icon\" href=\"/favicon.png\">\n            <link href=\"https://unpkg.com/ionicons@4.0.0/dist/css/ionicons.min.css\"rel=\"stylesheet\"/>\n            <title>Bitcharge</title>\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n            ${assets.client.css ? `<link rel=\"stylesheet\" href=\"${assets.client.css}\">` : ''}\n            ${process.env.NODE_ENV === 'production' ? `<script src=\"${assets.client.js}\" defer></script>` : `<script src=\"${assets.client.js}\" defer crossorigin></script>`}\n        </head>\n        <body>\n            ${markup}\n        </body>\n    </html>`\n          )\n        }\n      })\n      .catch(error => {\n        console.log(error)\n        res.status(500).json({ error: error.message, stack: error.stack })\n      })\n  })\n\nexport default server\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AADA;AAIA;AACA;AACA;AACA;AACA;AAmBA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}